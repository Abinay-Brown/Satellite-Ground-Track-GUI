from scipy import interpolate
import numpy as np

def atmModel(r):
	# rpa is the perigee distance in meters.
	# r is the current in orbit in meters.
	earthRadius = 6378137	# meters
	r = (r - earthRadius) / 1000 # determine altitude in meters
	
	h_ellp = [0,25,30,40,50,60,70,80,90,100,110,120,130 \
	,140,150,180,200,250,300,350,400,450,500,600,700,800,900,1000]
	

	base_alt = [0, 25, 30, 40, 50, 60, 70, 80, 90, 100, 110 \
	, 120, 130, 140, 150, 180, 200, 250, 300, 350, 400 \
	, 450, 500, 600, 700, 800, 900, 1000]
	
	rho_nominal = [1.225, 3.899*(10**(-2)), 1.774*(10**(-2)), 3.972*(10**(-3)) \
	, 1.057*(10**(-3)), 3.206*(10**(-4)), 8.77*(10**(-5)), 1.905*(10**(-5)) \
	, 3.396*(10**(-6)), 5.297*(10**(-7)), 9.661*(10**(-8)), 2.438*(10**(-8))\
	, 8.484*(10**(-9)), 3.845*(10**(-9)), 2.07*(10**(-9)), 5.464*(10**(-10))\
	, 2.784*(10**(-10)), 7.248*(10**(-11)), 2.418*(10**(-11)), 9.518*(10**(-12))\
	, 3.725*(10**(-12)), 1.585*(10**(-12)), 6.967*(10**(-13)), 1.454*(10**(-13))\
	, 3.614*(10**(-14)), 1.17*(10**(-14)), 5.245*(10**(-15)), 3.019*(10**(-15))]

	H = [7.249, 6.349, 6.682, 7.554, 8.382, 7.714, 6.549, 5.799, 5.382, 5.877, 7.263, 9.473\
	, 12.636, 16.149, 22.523, 29.740, 37.105, 45.546, 53.628, 53.298, 58.515, 60.828, 63.822\
	, 71.835, 88.667, 124.640, 181.050, 268]


	i = 0
	while (i < len(h_ellp)):
		if (r>= h_ellp[i]) and (r < h_ellp[i + 1]):
			index = i
			break
		elif (r >= 1000):
			index = len(h_ellp) - 1
			break
		i = i+1
	
	rho = rho_nominal[index]*np.exp(-(r-base_alt[index])/H[index])
	return rho